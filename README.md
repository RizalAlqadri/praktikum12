# ANALISIS KODE PROGRAM
## build_embeddings.py
Kode program di atas berfungsi untuk mengekstraksi embedding wajah dari dataset foto menggunakan fungsi embed_from_path yang berada di file utils_facenet.py. Proses dimulai dengan membaca folder data/train, di mana setiap subfolder dianggap sebagai satu kelas (misalnya nama orang). Fungsi iter_images() mengiterasi semua gambar dalam tiap kelas, kemudian build_matrix() memanggil embed_from_path() untuk menghasilkan embedding setiap gambar. Apabila sebuah gambar tidak dapat diproses, path-nya disimpan dalam daftar bad. Setelah semua gambar diproses, embedding (X) dan label kelas (y) dikonversi ke array NumPy dan disimpan sebagai file X_train.npy dan y_train.npy. Program juga mencetak jumlah embedding yang berhasil dibentuk, jumlah label, serta berapa gambar yang gagal terdeteksi. Secara keseluruhan, script ini berfungsi sebagai tahap preprocessing untuk menyiapkan data training FaceNet sebelum digunakan dalam model klasifikasi.
## predict_one.py
Kode di atas digunakan untuk melakukan prediksi identitas wajah menggunakan model SVM yang sudah dilatih sebelumnya. Model klasifikasi disimpan dalam file facenet_svm.joblib dan dimuat menggunakan joblib.load(). Fungsi predict_image() menerima path gambar, lalu menghasilkan embedding wajah melalui embed_from_path(). Jika wajah tidak terdeteksi, fungsi mengembalikan "NO_FACE". Setelah embedding diperoleh, model SVM memprediksi probabilitas setiap kelas, lalu memilih kelas dengan nilai probabilitas tertinggi sebagai label. Nilai kepercayaan (confidence) dibandingkan dengan unknown_threshold — jika di bawah ambang batas, wajah dianggap tidak dikenal dan hasilnya "UNKNOWN". Jika melewati ambang, label asli dikembalikan bersama nilai confidence-nya. Pada bagian __main__, kode akan memprediksi satu gambar uji dari folder data/val dan menampilkan hasil prediksi dalam format: Prediksi: <label> (conf=...).
## train_classifier.py
Kode di atas digunakan untuk melatih model klasifikasi wajah berbasis SVM dengan memanfaatkan embedding yang sebelumnya dihasilkan oleh FaceNet. Pertama, program memuat data embedding (X_train.npy) dan label (y_train.npy) kemudian membuat pipeline yang terdiri dari StandardScaler untuk menormalkan fitur dan SVC dengan kernel RBF, nilai C=10, serta probability=True agar bisa menghasilkan nilai confidence. Parameter class_weight="balanced" membantu menangani jumlah data per kelas yang tidak seimbang. Sebelum model dilatih penuh, dilakukan evaluasi cepat menggunakan cross-validation sebanyak 2 fold untuk melihat gambaran akurasi awal. Setelah itu model dilatih sepenuhnya dengan clf.fit(X, y) dan hasilnya disimpan ke file facenet_svm.joblib agar bisa dipakai saat prediksi. Secara keseluruhan, script ini adalah tahap training utama yang menyiapkan model SVM sebagai pengenal wajah berdasarkan embedding FaceNet.
## utils_facenet.py
Kode di atas adalah implementasi modul FaceNet yang bertugas melakukan deteksi wajah, alignment wajah, dan menghasilkan embedding (vektor fitur 512 dimensi) yang nantinya dipakai untuk training dan prediksi. Pertama, kode memuat MTCNN sebagai pendeteksi dan aligner wajah, lalu memuat model InceptionResnetV1 dari facenet-pytorch sebagai pembuat embedding. Gambar dibaca dengan OpenCV dalam format BGR, kemudian diubah ke format PIL sebelum diproses oleh MTCNN. Fungsi face_align() mengekstrak dan merapikan wajah menjadi ukuran 160×160 piksel. Fungsi embed_face_tensor() mengonversi wajah menjadi tensor, memindahkannya ke CPU/GPU, lalu mengembalikan embedding dalam bentuk array NumPy. Fungsi utama embed_from_path() menyatukan proses baca gambar, deteksi wajah, dan ekstraksi embedding; jika wajah tidak ditemukan, fungsi mengembalikan None. Selain itu, terdapat fungsi cosine_similarity() untuk mengukur kemiripan dua embedding. Secara keseluruhan, kode ini adalah fondasi utama pipeline FaceNet yang memastikan setiap gambar wajah diproses secara konsisten sebelum digunakan untuk klasifikasi atau evaluasi.
## verify_pair.py
Kode ini berfungsi untuk membandingkan dua gambar wajah dan menentukan apakah keduanya merupakan orang yang sama berdasarkan cosine similarity. Pertama, gambar img1 dan img2 diproses menggunakan fungsi embed_from_path() untuk menghasilkan embedding FaceNet, yaitu vektor 512 dimensi yang merepresentasikan fitur wajah. Jika salah satu embedding bernilai None, artinya MTCNN gagal mendeteksi wajah di gambar tersebut. Jika keduanya berhasil didapatkan, fungsi cosine_similarity() menghitung tingkat kemiripan antara kedua embedding. Nilai similarity berada pada rentang -1 hingga 1, di mana semakin mendekati 1 berarti wajah semakin mirip. Di akhir, program membandingkan nilai similarity tersebut dengan ambang batas 0.85; jika nilai similarity ≥ 0.85 maka kedua gambar dianggap cocok (“YA”), dan jika kurang dari itu dianggap bukan orang yang sama (“TIDAK”). Dengan demikian, kode ini merupakan alat sederhana untuk verifikasi wajah berbasis FaceNet.
